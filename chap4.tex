\chapter{Results}
\label{chap:results}

The results of four simple benchmarks of WARP against Serpent 2.1.18 and MCNP 6.1 are presented in this section.  All of the benchmarks make use nuclear data loaded from the ACE libraries that Serpent uses.  MCNP 6.1 uses the nuclear data distributed with it, which is also from ENDFB/VII, but since the library files are identical between Serpent and WARP, the error comparisons in this section are made against Serpent, not MCNP.  WARP only uses collision estimators for flux tallies and $k_\mathrm{eff}$ estimations, so the collision estimates from Serpent and MCNP are also used.  Serpent and MCNP have more sophisticated estimators as well, but a comparing WARP against their collision estimators specifically will provide the fairest comparison.  Serpent and MCNP are also run serially, which gives them the best theoretical performance when is comes to scaling, i.e. they are assumed to scale perfectly linearly.  In this way, the card that WARP runs on can be equivocated to a certain number of CPU cores, and a conservative performance per cost comparison can be made.

All of the benchmark cases were run on a server containing two AMD Opteron 6128 Magny-Cours processors.  These processors each contain eight cores which are clocked at 2.0Ghz and have a 512kB L2 cache.  The server has 32 GB of DDR3 clocked at 1.333GHz between the two processors.  The GPU used in the benchmarks is a NVIDIA Tesla k20.  It has 2496 ``CUDA cores,'' a multiprocessor clock of 706MHz, and 5GB of 2.6GHz GDDR5 global memory.  The Opteron 6128 was released in Q2 of 2010, whereas the k20 was released in Q4 2012 \cite{opterondate,k20date}.  This is a comparison of one of the newest Tesla cards with a older CPU, but it is a standard CPU for many supercomputer systems currently running and is sufficient if given every advantage in the comparison (i.e. perfect scaling linearity).

The multiplication factor differences are reported in ``per cent mille,'' which is a thousandth of a percent, or $10^{-5}$.  This is a standard way of reporting differences in the multiplication factor, as any small deviation from unity can cause a reactor to change its power level.  The flux spectra are normalized per source neutron and per lethargy.  Normalizing per source neutron serves to reproduce the same results for different numbers of histories run.  The uncertainty will be lower in results with more histories, of course, but the magnitudes should have the same mean values.   ``Lethargy'' means the logarithm of the neutron energy, $\ln(E_0/E)$, and is convenient since neutrons lose a fraction of energy per collision \cite{duderstadt}.  Normalizing the flux per lethargy accentuates the the high energy region of the flux, and is convenient in plotting spectra since otherwise overshadowed structure in the high-energy regions can be seen.  To plot the raw tally values, shown in \eqref{flux_tally}, the values must be divided by the total number of source neutrons run, divided by the energy bin width to , and multiplied by the average bin energy to normalized by lethargy \cite{lethargyplot}.  The expression for normalizing the raw tally scores is shown in \eqref{fluxtallynorm}, where $\bar{\phi}_{g,j}$ is the raw tally value in cell volume $j$ and energy group $g$.  Since WARP does not include S($\alpha$,$\beta$) or unresolved resonance tables (yet), these features were not activated in MCNP or Serpent in the benchmark runs.  WARP is currently only able to handle black, or vacuum, boundary conditions, so all the benchmark runs use black boundary condition as well.

\begin{equation}
\label{fluxtallynorm}
\begin{gathered}
E_g < E_i < E_{g+1} \\
|\bar{\phi}_{g,j}| = \left( \frac{1}{N_\mathrm{total}}\right) \left(\frac{1}{E_{g+1}-E_g}\right) \left(\frac{E_g+E_{g+1}}{2} \right) \bar{\phi}_{g,j}
\end{gathered}
\end{equation}

Five benchmark cases were considered, four that are criticality-source type, and one that is a fixed-source type.  WARP can represent spheres, cuboids, cylinders, and hexagonal prisms, and all but the hexagonal prism are represented in the benchmarks.  Most of the cases have very simple geometries with few cells, but the assembly case has 632 total cells to accentuate the geometry processing routines and the impact of the material resampling as the neutrons move into different regions without interacting.  Every material in every benchmark case uses some combination of Pu-239, U-238, U-235, O-16, B-10, and H-1.  This is a relatively small set of isotopes to have in a reactor simulation, but loading and processing of isotopes was only tested with Al-27, Pb-208, C-12, Li-6 in addition to these isotopes.  Currently a temperature of 300K is hardcoded into WARP, so cross sections used in these benchmarks are all processed at this temperature.   The summary of the benchmark geometries and materials is shown in Table \ref{benchmark_setup}.  

The ``Jezebel'' benchmark is a bare plutonium sphere, and is a standard criticality test.   The fission neutrons rate from Pu-239 is balanced by the leakage rate from the 5.1cm radius to give a $k_\mathrm{eff}$ of approximately 1.  Since this system is so leaky, producing results consistent with MCNP and Serpent ensure that the boundary conditions are correctly being enforced.  

The ``homogenized block'' benchmark consists of a single cell and a single material as well, but that material has multiple isotopes in it.  This particular material is a one-to-one mixture of 1\% U-235 enriched UO$_2$ and water.  The cell dimensions are quite large as well to emphasize material processing instead of leakage.

The ``pin cell'' benchmark consists of bare UO$_2$ cylinder surrounded by a block of water.  This benchmark now has two materials, each with multiple isotopes, and two cells.  The water block dimensions are not very large, so leakage should play a part.  This benchmark serves to highlight all the processing routines work simultaneously, and the effect of introducing more than one cell, which should have a significant effect on the ray tracing rate as pointed out in the preliminary OptiX study.

The ``15-sided Hex Assembly'' benchmark consists of 631 bare UO$_2$ cylinders laid out in a hexagonal lattice surrounded by water.  The material compositions, densities, and the cylinder dimensions are identical to the pin cell benchmark case, but since this benchmark has two orders of magnitude more objects, it serves to highlight the effect of introducing many geometric objects into the problem and will further validate that the geometry processing routines work correctly if consistent results are obtained.

The ``Fixed-source Block'' benchmark is identical to the homogenized block benchmark in terms of geometry and materials, except for the addition of a small amount B-10 to supress the multiplication factor as to not make runtimes extremely long (the multiplication for $k_\mathrm{eff}$=0.94 is about 17).   A 1eV isotropic point source at the origin was chosen as to highlight the effectiveness of popping any secondary neutrons back into the active transport cycle.  Since the source is at 1eV, it will induce fissions in U-235 which will produce neutrons in a fission spectrum that does not overlap with the source.  

\begin{table}[h]
\centering
\caption{The five benchmark cases.}
\label{benchmark_setup}
\begin{tabular}{| l | c | c | c | c |}
 \hline
 Benchmark & No. Cells & Materials & Isotopes & Densities \\
 \hline
  \hline
 Jezebel                           & 1 sphere, r=5.1cm & Fuel & (1.00) Pu-239 & 19.816 g/cm$^3$\\
  \hline
 \multirow{4}{*}{Homogenized Block}  & \multirow{4}{*}{1 cube, 2m$^3$ } & \multirow{4}{*}{Hom. Fuel.} & (0.99) U-238  & \multirow{4}{*}{10  g/cm$^3$} \\
 & & & (0.01) U-235 & \\
 & & & (3.00) O-16   & \\
 & & & (2.00) H-1     & \\
  \hline
 \multirow{5}{*}{Pin Cell}                        & \multirow{4}{*}{1 cuboid, 10x10x50cm} & \multirow{3}{*}{Fuel} & (0.90) U-238 & \multirow{3}{*}{15  g/cm$^3$} \\
 &  \multirow{4}{*}{1 cylinder, r=1cm z=40cm} & & (0.10) U-235 & \\
  & & & (2.00) O-16 & \\
 \cline{3-5}
 & & \multirow{2}{*}{Water} & (1.00) O-16 &  \multirow{2}{*}{3  g/cm$^3$} \\
 & & & (2.00) H-1 & \\
  \hline
  \multirow{4}{*}{15-sided}  & \multirow{4}{*}{1 cube, 84cm$^3$} & \multirow{3}{*}{Fuel} & (0.90) U-238 & \multirow{3}{*}{15  g/cm$^3$} \\
 \multirow{4}{*}{Hex Assembly}   & \multirow{4}{*}{631 cylinders, r=1cm z=40cm} & & (0.10) U-235 & \\
     & & & (2.00) O-16 & \\
 \cline{3-5}
 & & \multirow{2}{*}{Water} & (1.00) O-16 &  \multirow{2}{*}{3  g/cm$^3$} \\
 & & & (2.00) H-1 & \\
  \hline
 \multirow{5}{*}{Fixed-source Block}  & \multirow{4}{*}{1 cube, 2m$^3$ } & \multirow{4}{*}{Hom. Fuel.} & (0.99) U-238  & \multirow{4}{*}{10  g/cm$^3$} \\
 & &  \multirow{4}{*}{with B-10} & (0.01) U-235 & \\
 & & & (3.00) O-16   & \\
 & & & (0.01) B-10   & \\
 & & & (2.00) H-1     & \\  
 \hline
 \end{tabular}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Multiplication Factors and Runtimes}

The goal of WARP is to be the first step in creating a full-featured continuous energy Monte Carlo neutron transport code that is \emph{accelerated} by running on GPUs.  The crux of the effort is to make Monte Carlo calculations faster but still produce accurate results.  Table \ref{benchmark_summary_5} shows the multiplication factor deviations and the speedup factors for the four criticality benchmarks compared to MCNP 6.1 and Serpent 2.1.18 when $10^5$ neutrons per batch are used.  Table  \ref{benchmark_summary_6} shows the same information, but for cases where $10^6$ neutrons per batch are used.

\begin{table}[h]
\centering
\caption{Summary of $k_\mathrm{eff}$ single-run results of the WARP criticality benchmarks with 20/40 discarded/active criticality cycles and $10^5$ histories per cycle.}
\label{benchmark_summary_5}
\begin{tabular}{| l | r | r | r | r | r |}
 \hline
 Benchmark & MCNP 6.1 & Serpent 2.1.18 & WARP & $\Delta$ M & $\Delta$ S  \\
\hline
\hline
\multicolumn{6}{|l|}{Jezebel}  \\
\hline
 $k_\mathrm{eff}$ & 1.027509$\pm$0.0005 & 1.02748$\pm$0.00052 & 1.02789 & -38.1 pcm (y) & -41 pcm (y) \\
 \hline
 Runtime               & 2.32 m & 9.50868 m & 0.2752 m & 8.4x  & 34.6x  \\
 \hline
 \hline
\multicolumn{6}{|l|}{Homogenized Block }\\
\hline
 $k_\mathrm{eff}$ & 0.943049$\pm$0.0003 & 0.940306$\pm$0.00046 & 0.941916 & 113 pcm (n)  & -161 pcm  (n) \\
 \hline
 Runtime               &  25.58 m & 18.7190 m & 0.761 m & 33.6x  & 24.6x  \\
 \hline
  \hline
\multicolumn{6}{|l|}{Pin Cell}\\
\hline
 $k_\mathrm{eff}$ & 0.381435$\pm$0.0008 &  0.380511$\pm$0.00128 & 0.380586 & 84.9 pcm (n)&  -7.5 pcm (y)    \\
 \hline
 Runtime               & 55.85 m & 40.0035 m &  2.81583 m &  19.8x & 14.2x  \\
 \hline
  \hline
\multicolumn{6}{|l|}{15-sided Hex Assembly}\\
\hline
 $k_\mathrm{eff}$ & 1.437465$\pm$0.0004 & 1.44704$\pm$0.00046 & 1.4442 & -673 pcm (n) & 284 pcm (n) \\
 \hline
 Runtime               & 25.34 m &  26.3349 m &  3.2395 m  & 7.8x & 8.1x  \\
 \hline
\end{tabular}
\end{table}


\begin{table}[h]
\centering
\caption{Summary of $k_\mathrm{eff}$ single-run results of the WARP criticality benchmarks with 20/40 discarded/active criticality cycles and $10^6$ histories per cycle.}
\label{benchmark_summary_6}
\begin{tabular}{| l | r | r | r | r | r |}
 \hline
 Benchmark & MCNP 6.1 & Serpent 2.1.18 & WARP & $\Delta$ M & $\Delta$ S  \\
\hline
\hline
\multicolumn{6}{|l|}{Jezebel}  \\
\hline
 $k_\mathrm{eff}$ & 1.027957$\pm$0.0001 & 1.02806$\pm$0.00017 & 1.0279 & 5.7 pcm (y)& 16 pcm  (y) \\
 \hline
 Runtime               & 22.79 m & 94.4311 m &  2.0147 m & 11.3x  & 46.9x  \\
 \hline
 \hline
\multicolumn{6}{|l|}{Homogenized Block }\\
\hline
 $k_\mathrm{eff}$ & 0.942670$\pm$0.0001 & 0.939868$\pm$0.00021 & 0.94261 & 6 pcm (y) &  -274.4 pcm (n)  \\
 \hline
 Runtime               & 255.57 m & 185.966 m & 3.934 m & 64.96x & 47.28x  \\
 \hline
  \hline
\multicolumn{6}{|l|}{Pin Cell}\\
\hline
 $k_\mathrm{eff}$ & 0.381405$\pm$0.0003 & 0.380615$\pm$0.00035 & 0.38043 & 97.5 pcm (n) &  18.5 pcm (n)  \\
 \hline
 Runtime               & 578.62 m & 391.995 m & 7.0682 m & 81.85x & 55.46x \\
 \hline
  \hline
\multicolumn{6}{|l|}{15-sided Hex Assembly}\\
\hline
 $k_\mathrm{eff}$ & 1.437711$\pm$0.0001 & 1.44706$\pm$0.00013 & 1.4454 & -769 pcm (n) &  166 pcm (n) \\
 \hline
 Runtime               & 252.77 m & 260.508 m & 7.9703 m & 31.71x & 32.68x \\
 \hline
\end{tabular}
\end{table}

It can be seen that in the $10^5$ neutrons per batch case, WARP performs 8 to 35 times faster than the production codes, and the multiplication factor differences are slightly different.  Most multiplication factors are most notably different in the assembly benchmark, where WARP's answer falls between MCNP and Serpent, but is still very far from either.  Similar trends are shown in the multiplication factor for the $10^6$ runs in Table \ref{benchmark_summary_6}, but the speedup factors are much higher, with WARP being 11 to 82 times faster than the production codes.   The greatest speedup is seen in the pin cell benchmark, followed by the homogenized block, assembly, then finally the bare sphere.  The speedup factors compared to Serpent in the $10^6$ neutrons per batch runs are relatively constant, ranging from 33 to 56, whereas the speedup factors compared to MCNP range from 11 to 82.

The (y) in the $\Delta$ columns signify if the WARP value is inside (y) or outside (n) one standard deviation of the production code's value.  In the Jezebel benchmark, all codes agree, but as things get more complicated, deviations start to occur.  WARP is often outside of a single standard deviation for either code.  It is important to point out that Serpent and MCNP are also often more than a standard deviation away from each other, with WARP falling somewhere in between, or if not in between, near one of the two codes.

It is also interesting that in the Jezebel benchmark, MCNP is actually much faster than Serpent.  Presumably, this is do to the different methods they use for neutron tracking.  Serpent uses Woodcock tracking, and moves the neutron in small steps across the geometry, but does not have to calculate any surface intersection points.  MCNP uses ray tracing and does calculate intersection points (as does WARP).  Since the Jezebel sphere is a very leaky system, many neutrons stream out of the sphere without interacting many times or at all.  Since  MCNP and WARP both use ray tracing, they can terminate this particles in a small number of geometry queries.  Serpent, however, needs to query the geometry many times in order to propagate the neutrons to the edge of the sphere where they are then leaked.  This difference is not seen in the homogenized block benchmark, where leakage plays very little role in neutron loss.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Flux Spectra and Fission Distributions}

\begin{figure}[h!] 
\centering
\includegraphics[width=\textwidth,trim= 1cm 0cm 1cm 0cm]{graphics/finalresults/godiva_spec-6.eps}
\caption{Spectrum comparison in a ``Jezebel'' bare Pu-239 sphere. \label{godiva_spec} }
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth,trim= 5cm 0cm 7cm 0cm]{graphics/finalresults/godiva_fiss-6.eps}
\caption{Fission source distribution of a ``Jezebel'' bare Pu-239 sphere. \label{godiva_fiss} }
\end{figure}

\begin{figure}[h!] 
\centering
\includegraphics[width=\textwidth,trim= 1cm 0cm 1cm 0cm]{graphics/finalresults/homfuel_spec-6.eps}
\caption{Spectrum comparison in a homogenized block of UO$_2$ and water. \label{homfuel_spec} }
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth,trim= 5cm 0cm 7cm 0cm]{graphics/finalresults/homfuel_fiss-6.eps}
\caption{Fission source distribution of a homogenized block of UO$_2$ and water. \label{homfuel_fiss} }
\end{figure}

The flux and fission source distributions for the criticality benchmarks are shown in the following figures.  To show the most accurate and highest resolution results, the data in these figures are from runs using $10^6$ neutrons per batch.  The corresponding Serpent fission source and thermal flux mesh plots are included in Figures \ref{serp_godiva_mesh}-\ref{serp_assembly_mesh} in Appendix \ref{app:A} so the fission source distributions shown here can be visually validated against them.  

Figures \ref{godiva_spec} and \ref{godiva_fiss}, show the volume-averaged flux spectrum and fission source distribution, respectively, in the Jezebel sphere.  The relative error compared to the Serpent spectrum is show in the subplot below the main spectrum plot.  The relative error is very low compared to Serpent, with the normalized tally bins being less than 2\% from each other in regions where the flux is large.  Of course, when the flux is small, the statistical uncertainty becomes much higher, and the relative error becomes noisy.  The spectra produced by the three codes lie very close together and are almost indistinguishable from each other in the plot.  The fission distribution appears very uniform with neutrons being preferentially born near the center.  The distribution is visually identical in an $z$-integrated slice compared to the $y$-integrated slice, as it should be.

Figures \ref{homfuel_spec} and \ref{homfuel_fiss}, show the volume-averaged flux spectrum and fission source distribution, respectively, in the block of homogenized fuel.  Since this system is not leaky and contains light nuclides, neutrons should be able to easily scatter down to thermal energies and produce a thermal peak around 0.026 eV.  This feature is seen in the WARP spectrum, indicating that the target velocity sampling scheme is working correctly, as well as the vector transformation and rotation schemes.  Again, the relative error compared the the Serpent spectrum is very low, at 3\% or lower for energies $10^{-9}$-$10$ MeV where the flux has good statistics.  There are some strange sawtooth-like structures in the relative error plot in the thermal peak and the unresolved resonance regions, which could indicate that a minor sampling problem is occurring, and should be investigated as WARP continues to develop.  The fission source distribution shows very interesting nebulous structure, which might indicate that the fission source has not been fully sampled.  This may be to the fact that the block is so large, but the results should be almost same as a fully converged source since most neutrons never encounter geometry anyway.  The edges falloff to zero as they should, and the overall appearance of the distribution is quite uniform.

Figures \ref{pincell_spec} and \ref{pincell_fiss}, show the volume-averaged flux spectrum and fission source distribution, respectively, in the UO$_2$ pin of the pin cell benchmark.  This system is slightly leaky, and again contains light nuclides (water), but now they are spatially separated from the fissile material.  The relative error compared to Serpent is again very low, around 3\% or lower for energies $5\times10^{-9}$-$10$ MeV where the flux has good statistics.  There is a small thermal peak in the spectrum compared to that of the homogenized fuel material.  This is expected behavior as the fuel has a much higher cross section at these energies than the homogenized fuel material.  This effect can also be seen in the fission source distribution as a ring of high probability around the edge of the pin.  This is cause by thermalized neutrons re-entering the fuel pin and immediately fissioning a U-235 nucleus.  This phenomenon is also called ``self-shielding'' since the uranium at the surface shields the interior uranium from thermal neutrons and has implications in depletion and power distributions.  Since the flux spectrum is volume averaged over the pin, the small thermal peak is most likely from the inclusion of this thin edge region where thermal neutrons still exist.  The axial fission source distribution follows an expected behavior of a finite cylinder as well, roughly following a cosine with the peak at $z=0$ \cite{duderstadt}.

 
\begin{figure}[h!] 
\centering
\includegraphics[width=\textwidth,trim= 1cm 0cm 1cm 0cm]{graphics/finalresults/pincell_spec-6.eps}
\caption{Spectrum comparison in a single UO$_2$ pin surrounded by a block of water. \label{pincell_spec} }
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=.75\textwidth]{graphics/finalresults/pincell_fiss-6.eps}
\caption{Fission source distribution of a single UO$_2$ pin surrounded by a block of water. \label{pincell_fiss} }
\end{figure}

\begin{figure}[h!] 
\centering
\includegraphics[width=\textwidth,trim= 1cm 0cm 1cm 0cm]{graphics/finalresults/assembly_spec-6.eps}
\caption{Spectrum comparison in the center UO$_2$ pin of a 15-sided hexagonal pin array in water. \label{assembly_spec} }
\end{figure}

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth,trim= 4cm 0cm 6cm 0cm]{graphics/finalresults/assembly_fiss-6.eps}
\caption{Fission source distribution of a 15-sided hexagonal array of UO$_2$ pins in water. \label{assembly_fiss} }
\end{figure}
	

Figures \ref{assembly_spec} and \ref{assembly_fiss}, show the volume-averaged flux spectrum and fission source distribution, respectively, in the center pin of the 15-sided hexagonal assembly benchmark.  This problem is much more heterogeneous than any of the previous, with 300 times more objects in the domain compared to the pin cell benchmark.  The WARP's spectrum matches very well with Serpent's, and the relative error is with 15\% of Serpent  for energies $10^{-8}$-$9$ MeV where the flux has good statistics.  The spectrum is much noisier than any of the other benchmarks since the volume of the center pin is relatively small compared to the volume of the fission source, even though this pin has the highest flux of any of the pins.  The mean of the error appears to be close to zero, however, and the high error is most likely due to statistics.  The MCNP spectrum is slightly higher than both the WARP and Serpent spectra, which might be a small normalization error or a real difference.  The fission source distribution appears as expected, with the highest average probability in the center of the array both axially and radially.  Self-shielding is shown again, as every pin has a ring of higher probability on near its surface.  The assembly also shows some reflection effects from the thick layers of water surrounding it.  The pins at the edges have a higher fission source probability at the surfaces facing the water rather than the interior of the assembly.  This is due to neutrons being abel to scatter many times in the large volume of water and eventually scattering into an edge pin where there are immediately absorbed.  This phenomenon is apparent in both the axial and radial directions.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Fixed Source}

\begin{table}[h]
\centering
\caption{Summary of $k_\mathrm{eff}$ single-run results of the WARP fixed-source benchmark with $40^7$ total histories.}
\label{fixed_summary}
\begin{tabular}{| l | r | r | r | r | r |}
 \hline
  U235, 1eV PS & MCNP 6.1 & Serpent 2.1.18 & WARP & $\Delta$ M & $\Delta$ S  \\
\hline
\hline
 $k_\mathrm{eff}$ & 0.6442 (inferred) & 0.749278$\pm$0.000019 & 0.752093 & -10.8\%  & -281.5 pcm   \\
 \hline
 Runtime               & 35.22 m & 4.317 m &  2.0925 m & 16.8x  & 2.1x  \\
 \hline
\end{tabular}
\end{table}

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth,trim= 1cm 0cm 1cm 0cm]{graphics/finalresults/fixed_spec.eps}
\caption{Flux spectra of fixed source calculations of a 1eV points source in a block of uranium-235 . \label{fixed_spec} }
\end{figure}

WARP is also able to run simulations in fixed-source mode, where the initial neutron energies, directions, and locations are predefined and do not incorporate any feedback from the flux like the criticality source.  This mode adds any induced secondary neutrons back into the active particle dataset to be transported in conjunction with the source neutrons, which is also why these problems must be subcritical.  The materials and geometry are the same as the homogenized block since this case was 

Figure \ref{fixed_spec} shows a comparison of the spectra produced by WARP compared to Serpent 2.1.18 and MCNP 6.1.  

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Run Profiles}

profiler stuff, time in each routine.  compare assembly and homfuel.  compare w non-remapped

stats, the way the active particles die off for assembly and homfuel.  include the non-remapped version in the time/cycle plot.  runtimes...

remapping has a huge impact on OptiX runtime?  or just in cases where neutrons don't die off quickly and the tail becomes much more important where a lot of time is wasted on processing blocks full of neutrons that just return.

point out the number of iterations to get to 0 active, means that the non remapping routine spends quite a bit of time in the slow section of the processing curve.

state smoothing and interpolation parameters, problem with cycle time becoming small and NaNs appearing

pop is rather expensive, which is why the fixed source problems are much slower!  pop needs to be done at every innter loop iteration, whereas in crit, it is done once at the end of the inner loop

\begin{table}[h]
\centering
\caption{Summary table of the time spent in each WARP subroutine in criticality mode for each benchmark case.}
\label{profile_summary}
\begin{tabular}{| l | r  | r | r | r |}
\multicolumn{5}{l}{Remapping} \\
 \hline
 Subroutine & Jezebel & Homogenized Block & Pincell & 15-sided Hex Assembly  \\
\hline
\hline
\multicolumn{5}{l}{} \\
\multicolumn{5}{l}{Non-Remapping} \\
 \hline
 Subroutine & Jezebel & Homogenized Block & Pincell & 15-sided Hex Assembly  \\
\hline
\hline
\end{tabular}
\end{table}

\begin{figure}[h!]
\centering
\includegraphics[width=\textwidth]{graphics/finalresults/process_rate.eps}
\caption{Neutron processing rate of WARP in the homogenized block and assembly benchmark cases. \label{process_rate} }
\end{figure}

\begin{table}[h]
\centering
\caption{Comparison of the non-remapping and remapping versions of WARP for the four criticality benchmark cases.  20/40 discarded/active criticality cycles and $10^6$ histories per cycle.}
\label{benchmark_nonremapping_summary}
\begin{tabular}{| l | r | r | r |}
 \hline
 Benchmark & Remapping WARP & Non-Remapping WARP & $\Delta k$ or Ratio  \\
\hline
\hline
\multicolumn{4}{|l|}{Jezebel}  \\
\hline
 $k_\mathrm{eff}$ & 1.0279 & 1.0279  & 0 pcm\\
 \hline
 Runtime               &   2.0147 m & 1.84 m & 0.91x \\
 \hline
 \hline
\multicolumn{4}{|l|}{Homogenized Block }\\
\hline
 $k_\mathrm{eff}$ & 0.9426 & 0.941857 & 74.3 pcm  \\
 \hline
 Runtime               &  3.934 m & 4.05 m & 1.03x \\
 \hline
  \hline
\multicolumn{4}{|l|}{Pin Cell}\\
\hline
 $k_\mathrm{eff}$ &  0.3804 & 0.38063  & -23 pcm \\
 \hline
 Runtime               & 7.0682 m & 10.52 m & 1.49x \\
 \hline
  \hline
\multicolumn{4}{|l|}{15-sided Hex Assembly}\\
\hline
 $k_\mathrm{eff}$  & 1.4454  & 1.4457 & -30 pcm \\
 \hline
 Runtime               & 7.9703 m & 95.85 m & 12.03x \\
 \hline
\end{tabular}
\end{table}






